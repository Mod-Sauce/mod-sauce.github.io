<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Test Uploads - Mod-Sauce</title>
        <link rel="shortcut icon" type="image/x-icon" href="favicon.ico?" />
        <link rel="stylesheet" type="text/css" href="style.css" />
        <link
            rel="stylesheet"
            type="text/css"
            href="assets/css/theme-toggle.css"
        />
    </head>
    <body>
        <!-- Main Content -->
        <main class="main-content">
            <div class="card upload-card">
                <div class="input-group">
                    <label for="mod-select">Mod</label>
                    <select id="mod-select">
                        <option value="">Select Mod</option>
                    </select>
                </div>

                <div class="input-group hidden" id="loader-group">
                    <label for="loader-select">Loader</label>
                    <select id="loader-select">
                        <option value="">Select Loader</option>
                    </select>
                </div>

                <div class="input-group hidden" id="version-group">
                    <label for="version-select">Version</label>
                    <select id="version-select">
                        <option value="">Select Version</option>
                    </select>
                </div>

                <div class="input-group hidden" id="download-group">
                    <a href="#" id="download-btn" class="btn">Download</a>
                </div>

                <div id="version-warning"></div>
            </div>
        </main>

        <script>
            let downloadsConfig = {};

            fetch("https://codeberg.org/Mod-Sauce/pages/raw/branch/main/downloads.json")
                .then((res) => res.json())
                .then((data) => {
                    downloadsConfig = data;
                    populateMods();
                })
                .catch((err) => {
                    console.error("Error loading downloads.json:", err);
                });

            function populateMods() {
                const modSelect = document.getElementById("mod-select");
                const mods = Object.keys(downloadsConfig);

                mods.forEach((mod) => {
                    const option = document.createElement("option");
                    option.value = mod;
                    option.textContent = mod;
                    modSelect.appendChild(option);
                });
            }

            function populateLoaders(mod) {
                const loaderSelect = document.getElementById("loader-select");
                const loaderGroup = document.getElementById("loader-group");
                loaderSelect.innerHTML =
                    '<option value="">Select Loader</option>';

                if (mod && downloadsConfig[mod]) {
                    const loaders = Object.keys(downloadsConfig[mod]);
                    loaders.forEach((loader) => {
                        const option = document.createElement("option");
                        option.value = loader;
                        option.textContent = loader;
                        loaderSelect.appendChild(option);
                    });
                    loaderGroup.classList.remove("hidden");
                } else {
                    loaderGroup.classList.add("hidden");
                }
            }

            function populateVersions(mod, loader) {
                const versionSelect = document.getElementById("version-select");
                const versionGroup = document.getElementById("version-group");
                versionSelect.innerHTML =
                    '<option value="">Select Version</option>';

                if (mod && loader && downloadsConfig[mod][loader]) {
                    const versions = Object.keys(downloadsConfig[mod][loader]);
                    versions.forEach((version) => {
                        const option = document.createElement("option");
                        option.value = version;
                        option.textContent = version;
                        versionSelect.appendChild(option);
                    });
                    versionGroup.classList.remove("hidden");
                } else {
                    versionGroup.classList.add("hidden");
                }
            }

            document
                .getElementById("mod-select")
                .addEventListener("change", function () {
                    const mod = this.value;
                    populateLoaders(mod);
                    document
                        .getElementById("version-group")
                        .classList.add("hidden");
                    document
                        .getElementById("download-group")
                        .classList.add("hidden");
                    const warningDiv =
                        document.getElementById("version-warning");
                    warningDiv.innerHTML = "";
                    warningDiv.className = "";
                });

            document
                .getElementById("loader-select")
                .addEventListener("change", function () {
                    const mod = document.getElementById("mod-select").value;
                    const loader = this.value;
                    populateVersions(mod, loader);
                    document
                        .getElementById("download-group")
                        .classList.add("hidden");
                    const warningDiv =
                        document.getElementById("version-warning");
                    warningDiv.innerHTML = "";
                    warningDiv.className = "";
                });

            document
                .getElementById("version-select")
                .addEventListener("change", function () {
                    const downloadGroup =
                        document.getElementById("download-group");
                    const downloadBtn = document.getElementById("download-btn");
                    const warningDiv =
                        document.getElementById("version-warning");
                    const mod = document.getElementById("mod-select").value;
                    const loader =
                        document.getElementById("loader-select").value;
                    const version = this.value;

                    warningDiv.innerHTML = "";
                    warningDiv.className = "";
                    downloadGroup.classList.add("hidden");

                    if (mod && loader && version) {
                        const data = downloadsConfig[mod][loader][version];
                        if (data) {
                            if (data.url) {
                                downloadBtn.href = data.url;
                                downloadGroup.classList.remove("hidden");
                            }

                            if (data.note === "NA") {
                                warningDiv.textContent =
                                    "Currently no version available. Please check back later.";
                                warningDiv.className = "info-message";
                            } else if (data.note === "DEV") {
                                warningDiv.textContent =
                                    "Warning: Early development build.";
                                warningDiv.className = "warning-card";
                            }
                        }
                    }
                });
        </script>
        <script src="assets/js/navbar-loader.js"></script>
        <script src="assets/js/nav-theme.js"></script>
        <script src="assets/js/theme-toggle.js"></script>
        <script src="assets/js/footer-loader.js"></script>
    </body>
</html>
